angular.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minuteStep:5,minView:"minute",startView:"day",weekStart:0}).directive("datetimepicker",["dateTimePickerConfig",function(e){"use strict";var t=function(e){var t=["startView","minView","minuteStep","dropdownSelector","weekStart"];for(var a in e)if(e.hasOwnProperty(a)&&t.indexOf(a)<0)throw"invalid option: "+a;var r=["minute","hour","day","month","year"];if(r.indexOf(e.startView)<0)throw"invalid startView value: "+e.startView;if(r.indexOf(e.minView)<0)throw"invalid minView value: "+e.minView;if(r.indexOf(e.minView)>r.indexOf(e.startView))throw"startView must be greater than minView";if(!angular.isNumber(e.minuteStep))throw"minuteStep must be numeric";if(e.minuteStep<=0||e.minuteStep>=60)throw"minuteStep must be greater than zero and less than 60";if(null!==e.dropdownSelector&&!angular.isString(e.dropdownSelector))throw"dropdownSelector must be a string";if(!angular.isNumber(e.weekStart))throw"weekStart must be numeric";if(e.weekStart<0||e.weekStart>6)throw"weekStart must be greater than or equal to zero and less than 7"};return{restrict:"E",require:"ngModel",template:"<div class='datetimepicker'><table class='table-condensed'>   <thead>       <tr>           <th class='left'               data-ng-click='changeView(data.currentView, data.leftDate, $event)'               ><i class='glyphicon glyphicon-arrow-left'/></th>           <th class='switch' colspan='5'               data-ng-click='changeView(data.previousView, data.currentDate, $event)'>{{ data.title }}</th>           <th class='right'               data-ng-click='changeView(data.currentView, data.rightDate, $event)'             ><i class='glyphicon glyphicon-arrow-right'/></th>       </tr>       <tr>           <th class='dow' data-ng-repeat='day in data.dayNames' >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-class='{ hide: data.currentView == \"day\" }' >           <td colspan='7' >              <span    class='{{ data.currentView }}'                        data-ng-repeat='dateValue in data.dates'                         data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}'                        data-ng-click=\"changeView(data.nextView, dateValue.date, $event)\">{{ dateValue.display }}</span>            </td>       </tr>       <tr data-ng-show='data.currentView == \"day\"' data-ng-repeat='week in data.weeks'>           <td data-ng-repeat='dateValue in week.dates'                data-ng-click='changeView(data.nextView, dateValue.date, $event)'               class='day'                data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}' >{{ dateValue.display }}</td>       </tr>       <tr>           <td colspan='7' >              <a data-ng-class='{ hide: data.currentView == \"day\" }' class='btn btn-primary btn-sm pull-right'                        data-ng-click=\"changeView('setTime', data.currentDate, $event)\">\u0412\u044b\u0431\u0440\u0430\u0442\u044c</a>            </td>       </tr>   </tbody></table></div>",scope:{ngModel:"=",onSetTime:"="},replace:!0,link:function(a,r,n){var i={};n.datetimepickerConfig&&(i=a.$eval(n.datetimepickerConfig));var d={};angular.extend(d,e,i),t(d);var o={year:function(e){for(var t=moment.utc(e).startOf("year"),r=10*parseInt(t.year()/10,10),n=moment.utc(t).year(r-1).startOf("year"),i=a.ngModel?moment(a.ngModel).year():0,o={currentView:"year",nextView:"year"===d.minView?"setTime":"month",title:r+"-"+(r+9),leftDate:moment.utc(n).subtract(9,"year").valueOf(),rightDate:moment.utc(n).add(11,"year").valueOf(),dates:[]},u=0;12>u;u++){var m=moment.utc(n).add(u,"years"),s={date:m.valueOf(),display:m.format("YYYY"),past:m.year()<r,future:m.year()>r+9,active:m.year()===i};o.dates.push(s)}return o},month:function(e){for(var t=moment.utc(e).startOf("year"),r=a.ngModel?moment(a.ngModel).format("YYYY-MMM"):0,n={previousView:"year",currentView:"month",nextView:"month"===d.minView?"setTime":"day",currentDate:t.valueOf(),title:t.format("YYYY"),leftDate:moment.utc(t).subtract(1,"year").valueOf(),rightDate:moment.utc(t).add(1,"year").valueOf(),dates:[]},i=0;12>i;i++){var o=moment.utc(t).add(i,"months"),u={date:o.valueOf(),display:o.format("MMM"),active:o.format("YYYY-MMM")===r};n.dates.push(u)}return n},day:function(e){for(var t=moment.utc(e),r=moment.utc(t).startOf("month"),n=moment.utc(t).endOf("month"),i=moment.utc(r).subtract(Math.abs(r.weekday()-d.weekStart),"days"),o=a.ngModel?moment(a.ngModel).format("YYYY-MMM-DD"):"",u={previousView:"month",currentView:"day",nextView:"day"===d.minView?"setTime":"hour",currentDate:t.valueOf(),title:t.format("YYYY-MMM"),leftDate:moment.utc(r).subtract(1,"months").valueOf(),rightDate:moment.utc(r).add(1,"months").valueOf(),dayNames:[],weeks:[]},m=d.weekStart;m<d.weekStart+7;m++)u.dayNames.push(moment.utc().weekday(m).format("dd"));for(var s=0;6>s;s++){for(var c={dates:[]},l=0;7>l;l++){var f=moment.utc(i).add(7*s+l,"days"),w={date:f.valueOf(),display:f.format("D"),active:f.format("YYYY-MMM-DD")===o,past:f.isBefore(r),future:f.isAfter(n)};c.dates.push(w)}u.weeks.push(c)}return u},hour:function(e){for(var t=moment.utc(e).hour(0).minute(0).second(0),r=a.ngModel?moment(a.ngModel).format("YYYY-MM-DD H"):"",n={previousView:"day",currentView:"hour",nextView:"hour"===d.minView?"setTime":"minute",currentDate:t.valueOf(),title:t.format("YYYY-MMM-DD"),leftDate:moment.utc(t).subtract(1,"days").valueOf(),rightDate:moment.utc(t).add(1,"days").valueOf(),dates:[]},i=0;24>i;i++){var o=moment.utc(t).add(i,"hours"),u={date:o.valueOf(),display:o.format("H:00"),active:o.format("YYYY-MM-DD H")===r};n.dates.push(u)}return n},minute:function(e){for(var t=moment.utc(e).minute(0).second(0),r=a.ngModel?moment(a.ngModel).format("YYYY-MM-DD H:mm"):"",n={previousView:"hour",currentView:"minute",nextView:"setTime",currentDate:t.valueOf(),title:t.format("YYYY-MMM-DD H:mm"),leftDate:moment.utc(t).subtract(1,"hours").valueOf(),rightDate:moment.utc(t).add(1,"hours").valueOf(),dates:[]},i=60/d.minuteStep,o=0;i>o;o++){var u=moment.utc(t).add(o*d.minuteStep,"minute"),m={date:u.valueOf(),display:u.format("H:mm"),active:u.format("YYYY-MM-DD H:mm")===r};n.dates.push(m)}return n},setTime:function(e){var t=new Date(e),r=new Date(t.getTime());return d.dropdownSelector&&jQuery(d.dropdownSelector).dropdown("toggle"),angular.isFunction(a.onSetTime)&&a.onSetTime(r,a.ngModel),a.ngModel=r,o[a.data.currentView](e)}},u=function(){var e=a.ngModel?moment(a.ngModel).toDate():new Date;return e.getTime()};a.changeView=function(e,t,r){r&&(r.stopPropagation(),r.preventDefault()),e&&t>-1/0&&o[e]&&(a.data=o[e](t))},a.changeView(d.startView,u()),a.$watch("ngModel",function(){a.changeView(a.data.currentView,u())})}}}]);