!function(){"use strict";angular.module("blueimp.fileupload",[]).provider("fileUpload",function(){var e,o=function(){var e=angular.element(this).fileupload("option","scope")();e.$$phase||e.$apply()};e=this.defaults={handleResponse:function(e,o){var n=o.result&&o.result.files;n?o.scope().replace(o.files,n):(o.errorThrown||"error"===o.textStatus)&&(o.files[0].error=o.errorThrown||o.textStatus)},add:function(e,o){var n=o.scope();o.process(function(){return n.process(o)}).always(function(){var e=o.files[0],r=function(){return o.submit()};e.$cancel=function(){return n.clear(o.files),o.abort()},e.$state=function(){return o.state()},e.$progress=function(){return o.progress()},e.$response=function(){return o.response()},"rejected"===e.$state()?e._$submit=r:e.$submit=r,n.$apply(function(){var r=n.option("prependFiles")?"unshift":"push";Array.prototype[r].apply(n.queue,o.files),e.$submit&&(n.option("autoUpload")||o.autoUpload)&&o.autoUpload!==!1&&e.$submit()})})},progress:function(e,o){o.scope().$apply()},done:function(e,o){var n=this;o.scope().$apply(function(){o.handleResponse.call(n,e,o)})},fail:function(e,o){var n=this;if("abort"!==o.errorThrown){if(o.dataType.indexOf("json")===o.dataType.length-4)try{o.result=angular.fromJson(o.jqXHR.responseText)}catch(r){}o.scope().$apply(function(){o.handleResponse.call(n,e,o)})}},stop:o,processstart:o,processstop:o,getNumberOfFiles:function(){return this.scope().queue.length},dataType:"json",prependFiles:!0,autoUpload:!1},this.$get=[function(){return{defaults:e}}]}).provider("formatFileSizeFilter",function(){var e=this.defaults={units:[{size:1e9,suffix:" GB"},{size:1e6,suffix:" MB"},{size:1e3,suffix:" KB"}]};this.$get=function(){return function(o){if(!angular.isNumber(o))return"";for(var n=!0,r=-1;n;)if(n=e.units[r+=1],r===e.units.length-1||o>=n.size)return(o/n.size).toFixed(2)+n.suffix}}}).controller("FileUploadController",["$scope","$element","$attrs","fileUpload",function(e,o,n,r){e.disabled=angular.element('<input type="file">').prop("disabled"),e.queue=e.queue||[],e.clear=function(e){var o=this.queue,n=o.length,r=e,t=1;for(angular.isArray(e)&&(r=e[0],t=e.length);n;)if(o[n-=1]===r)return o.splice(n,t)},e.replace=function(e,o){var n,r,t=this.queue,l=e[0];for(n=0;n<t.length;n+=1)if(t[n]===l){for(r=0;r<o.length;r+=1)t[n+r]=o[r];return}},e.progress=function(){return o.fileupload("progress")},e.active=function(){return o.fileupload("active")},e.option=function(e,n){return o.fileupload("option",e,n)},e.add=function(e){return o.fileupload("add",e)},e.send=function(e){return o.fileupload("send",e)},e.process=function(e){return o.fileupload("process",e)},e.processing=function(e){return o.fileupload("processing",e)},e.applyOnQueue=function(e){var o,n,r=this.queue.slice(0);for(o=0;o<r.length;o+=1)n=r[o],n[e]&&n[e]()},e.submit=function(){this.applyOnQueue("$submit")},e.cancel=function(){this.applyOnQueue("$cancel")},o.fileupload(angular.extend({scope:function(){return e}},r.defaults)).on("fileuploadadd",function(o,n){n.scope=e.option("scope")}).on(["fileuploadadd","fileuploadsubmit","fileuploadsend","fileuploaddone","fileuploadfail","fileuploadalways","fileuploadprogress","fileuploadprogressall","fileuploadstart","fileuploadstop","fileuploadchange","fileuploadpaste","fileuploaddrop","fileuploaddragover","fileuploadchunksend","fileuploadchunkdone","fileuploadchunkfail","fileuploadchunkalways","fileuploadprocessstart","fileuploadprocess","fileuploadprocessdone","fileuploadprocessfail","fileuploadprocessalways","fileuploadprocessstop"].join(" "),function(o,n){e.$emit(o.type,n)}),e.$watch(n.fileupload,function(e){e&&o.fileupload("option",e)})}]).controller("FileUploadProgressController",["$scope","$attrs","$parse",function(e,o,n){var r=n(o.progress),t=function(){var o=r(e);o&&o.total&&(e.num=Math.floor(o.loaded/o.total*100))};t(),e.$watch(o.progress+".loaded",function(e,o){e!==o&&t()})}]).controller("FileUploadPreviewController",["$scope","$element","$attrs","$parse",function(e,o,n,r){var t=r(n.preview),l=t(e);l.preview&&o.append(l.preview)}]).directive("fileupload",function(){return{controller:"FileUploadController"}}).directive("progress",function(){return{controller:"FileUploadProgressController"}}).directive("preview",function(){return{controller:"FileUploadPreviewController"}}).directive("download",function(){return function(e,o){o.on("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",o.prop("download"),o.prop("href")].join(":"))}catch(n){}})}})}();